     1                                 %line 5+1 ../../textbook/ch12/nisqrt.asm
     2                                 
     3                                 [section .data]
     4 00000000 000000000000000001-     NumArr dq 0, 1, 2, 3, 4, 5, 6, 7, 8, 9,
     5 00000000 000000000000000200-
     6 00000000 000000000000030000-
     7 00000000 000000000004000000-
     8 00000000 000000000500000000-
     9 00000000 000000060000000000-
    10 00000000 000007000000000000-
    11 00000000 000800000000000000-
    12 00000000 0900000000000000   
    13 00000050 0A000000000000000B-     dq 10, 11, 12, 13, 14, 15, 16, 17, 18, 19,
    14 00000050 000000000000000C00-
    15 00000050 0000000000000D0000-
    16 00000050 00000000000E000000-
    17 00000050 000000000F00000000-
    18 00000050 000000100000000000-
    19 00000050 000011000000000000-
    20 00000050 001200000000000000-
    21 00000050 1300000000000000   
    22 000000A0 140000000000000015-     dq 20, 21, 22, 23, 24, 25, 26, 27, 28, 29,
    23 000000A0 000000000000001600-
    24 000000A0 000000000000170000-
    25 000000A0 000000000018000000-
    26 000000A0 000000001900000000-
    27 000000A0 0000001A0000000000-
    28 000000A0 00001B000000000000-
    29 000000A0 001C00000000000000-
    30 000000A0 1D00000000000000   
    31 000000F0 1E000000000000001F-     dq 30, 31, 32, 33, 34, 35, 36, 37, 38, 39,
    32 000000F0 000000000000002000-
    33 000000F0 000000000000210000-
    34 000000F0 000000000022000000-
    35 000000F0 000000002300000000-
    36 000000F0 000000240000000000-
    37 000000F0 000025000000000000-
    38 000000F0 002600000000000000-
    39 000000F0 2700000000000000   
    40 00000140 280000000000000029-     dq 40, 41, 42, 43, 44, 45, 46, 47, 48, 49,
    41 00000140 000000000000002A00-
    42 00000140 0000000000002B0000-
    43 00000140 00000000002C000000-
    44 00000140 000000002D00000000-
    45 00000140 0000002E0000000000-
    46 00000140 00002F000000000000-
    47 00000140 003000000000000000-
    48 00000140 3100000000000000   
    49 00000190 320000000000000033-     dq 50, 51, 52, 53, 54, 55, 56, 57, 58, 59,
    50 00000190 000000000000003400-
    51 00000190 000000000000350000-
    52 00000190 000000000036000000-
    53 00000190 000000003700000000-
    54 00000190 000000380000000000-
    55 00000190 000039000000000000-
    56 00000190 003A00000000000000-
    57 00000190 3B00000000000000   
    58 000001E0 3C000000000000003D-     dq 60, 61, 62, 63, 64, 65, 66, 67, 68, 69,
    59 000001E0 000000000000003E00-
    60 000001E0 0000000000003F0000-
    61 000001E0 000000000040000000-
    62 000001E0 000000004100000000-
    63 000001E0 000000420000000000-
    64 000001E0 000043000000000000-
    65 000001E0 004400000000000000-
    66 000001E0 4500000000000000   
    67 00000230 460000000000000047-     dq 70, 71, 72, 73, 74, 75, 76, 77, 78, 79,
    68 00000230 000000000000004800-
    69 00000230 000000000000490000-
    70 00000230 00000000004A000000-
    71 00000230 000000004B00000000-
    72 00000230 0000004C0000000000-
    73 00000230 00004D000000000000-
    74 00000230 004E00000000000000-
    75 00000230 4F00000000000000   
    76 00000280 500000000000000051-     dq 80, 81, 82, 83, 84, 85, 86, 87, 88, 89,
    77 00000280 000000000000005200-
    78 00000280 000000000000530000-
    79 00000280 000000000054000000-
    80 00000280 000000005500000000-
    81 00000280 000000560000000000-
    82 00000280 000057000000000000-
    83 00000280 005800000000000000-
    84 00000280 5900000000000000   
    85 000002D0 5A000000000000005B-     dq 90, 91, 92, 93, 94, 95, 96, 97, 98, 99,
    86 000002D0 000000000000005C00-
    87 000002D0 0000000000005D0000-
    88 000002D0 00000000005E000000-
    89 000002D0 000000005F00000000-
    90 000002D0 000000600000000000-
    91 000002D0 000061000000000000-
    92 000002D0 006200000000000000-
    93 000002D0 6300000000000000   
    94 00000320 6400000000000000        dq 100,
    95                                 
    96                                  Len equ 101
    97                                 
    98                                 [section .bss]
    99 00000000 <gap>                   SqrtArr resq Len
   100                                 
   101                                 [section .text]
   102                                 [global nisqrt]
   103                                 [global _start]
   104                                 
   105                                 nisqrt:
   106                                 
   107                                 
   108                                 
   109                                 
   110                                 
   111 00000000 53                      push rbx
   112                                 
   113 00000001 49C7C200000000          mov r10, 0
   114 00000008 4989FB                  mov r11, rdi
   115 0000000B 4C89DB                  mov rbx, r11
   116                                 nisqrt_bin_loop:
   117 0000000E 4C89D8                  mov rax, r11
   118 00000011 4C29D0                  sub rax, r10
   119 00000014 4883F801                cmp rax, 1
   120 00000018 761D                    jbe nisqrt_bin_loop_end
   121 0000001A 48D1E8                  shr rax, 1
   122 0000001D 4C01D0                  add rax, r10
   123 00000020 4889C3                  mov rbx, rax
   124 00000023 48F7E0                  mul rax
   125 00000026 4839F8                  cmp rax, rdi
   126 00000029 7202                    jb nisqrt_too_low
   127 0000002B 7705                    ja nisqrt_too_high
   128 0000002D EB08                    jmp nisqrt_bin_loop_end
   129                                 nisqrt_too_low:
   130 0000002F 4989DA                  mov r10, rbx
   131 00000032 EBD8                    jmp nisqrt_bin_loop
   132                                 nisqrt_too_high:
   133 00000034 4989DB                  mov r11, rbx
   134 00000037 EBD3                    jmp nisqrt_bin_loop
   135                                 nisqrt_bin_loop_end:
   136 00000039 4889D8                  mov rax, rbx
   137 0000003C 48F7E0                  mul rax
   138 0000003F 4839F8                  cmp rax, rdi
   139 00000042 7202                    jb nisqrt_test_incr_nearest
   140 00000044 7721                    ja nisqrt_test_decr_nearest
   141 00000046 EB3E                    jmp nisqrt_test_end
   142                                 nisqrt_test_incr_nearest:
   143 00000048 4989FA                  mov r10, rdi
   144 0000004B 4929C2                  sub r10, rax
   145 0000004E 4889D8                  mov rax, rbx
   146 00000051 48FFC0                  inc rax
   147 00000054 48F7E0                  mul rax
   148 00000057 4989C3                  mov r11, rax
   149 0000005A 4929FB                  sub r11, rdi
   150 0000005D 4D39DA                  cmp r10, r11
   151 00000060 7700                    ja nisqrt_test_accept_incr
   152 00000062 EB22                    jmp nisqrt_test_end
   153                                 nisqrt_test_accept_incr:
   154 00000064 48FFC3                  inc rbx
   155 00000067 EB1D                    jmp nisqrt_test_end
   156                                 nisqrt_test_decr_nearest:
   157 00000069 4989C2                  mov r10, rax
   158 0000006C 4929C2                  sub r10, rax
   159 0000006F 4889D8                  mov rax, rbx
   160 00000072 48FFC8                  dec rax
   161 00000075 48F7E0                  mul rax
   162 00000078 4989FB                  mov r11, rdi
   163 0000007B 4929C3                  sub r11, rax
   164 0000007E 4D39DA                  cmp r10, r11
   165 00000081 7700                    ja nisqrt_test_accept_decr
   166 00000083 EB01                    jmp nisqrt_test_end
   167                                 nisqrt_test_accept_decr:
   168 00000085 48FFCB                  dec rbx
   169                                 nisqrt_test_end:
   170 00000088 4889D8                  mov rax, rbx
   171                                 nisqrt_end:
   172 0000008B 5B                      pop rbx
   173 0000008C C3                     ret
   174                                 
   175                                 _start:
   176                                 
   177                                 
   178                                 
   179                                 
   180 0000008D 48C7C165000000          mov rcx, Len
   181 00000094 49C7C6[00000000]        mov r14, NumArr
   182 0000009B 49C7C7[00000000]        mov r15, SqrtArr
   183                                 _start_sqrt_loop:
   184 000000A2 498B3E                  mov rdi, QWORD [r14]
   185 000000A5 E851FFFFFF              call nisqrt
   186 000000AA 498907                  mov QWORD [r15], rax
   187 000000AD 4983C608                add r14, 8
   188 000000B1 4983C708                add r15, 8
   189 000000B5 E2E9                    loop _start_sqrt_loop
   190                                 
   191                                 
   192 000000B7 48C7C03C000000          mov rax, 60
   193 000000BE 48C7C700000000          mov rdi, 0
   194 000000C5 0F05                    syscall
